openapi: 3.1.0
info:
  title: "User API"
  description: "The OpenAPI specification for the Legion Labs User API."
  version: 1.0.0
paths:
  /v1/init/:
    get:
      description: Initialize the stack, and assign the superadmin role to the caller if no other user has it.
      operationId: initStack
      parameters:
        - in: header
          name: x-init-key
          schema:
            type: string
          required: true
      responses:
        "200":
          description: Ok.
        "403":
          description: The init-key is invalid.
        "409":
          description: The stack was already initialized.
  /v1/users/{user-id}/:
    parameters:
      - $ref: "#/components/parameters/user_id"
    get:
      description: Get the user information. Requires administrative privileges or that you call the API for yourself.
      operationId: getUserInfo
      responses:
        "200":
          description: Ok.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
        "404":
          description: The user with the specified id was not found.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserId"
  /v1/resolve-users/email/{email}:
    parameters:
      - name: email
        in: path
        required: true
        schema:
          type: string
        description: The user's email address.
    get:
      description: Resolve a user by its email address.
      operationId: resolveUserId
      responses:
        "200":
          description: Ok.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserId"
        "404":
          description: The user with the specified email was not found.
          content:
            application/json:
              schema:
                type: string
  /v1/users/{user-id}/spaces/:
    parameters:
      - $ref: "#/components/parameters/user_id"
    get:
      description: List all the spaces that the current user has access to.
      operationId: listUserSpaces
      responses:
        "200":
          description: Ok.
          content:
            application/json:
              schema:
                $ref: "space.yaml#/components/schemas/SpaceList"
  /v1/users/{user-id}/roles/:
    parameters:
      - $ref: "#/components/parameters/user_id"
    get:
      description: List all the roles that the current user has.
      operationId: listUserRoles
      responses:
        "200":
          description: Ok.
          content:
            application/json:
              schema:
                $ref: "role.yaml#/components/schemas/RoleAssignationList"
components:
  parameters:
    user_id:
      name: user-id
      in: path
      description: The user identifier.
      required: true
      schema:
        $ref: "#/components/schemas/UserId"
  schemas:
    UserId:
      description: An identifier to an unique user.
      type: string
    UserInfo:
      description: Information about a user.
      type: object
      properties:
        id:
          description: The user identifier.
          $ref: "#/components/schemas/UserId"
        name:
          description: The user's name.
          type: string
        family_name:
          description: The user's family name.
          type: string
        middle_name:
          description: The user's given name.
          type: string
        given_name:
          description: The user's given name.
          type: string
        email:
          description: The user's email address.
          type: string
      required:
        - id
        - name
        - family_name
        - middle_name
        - given_name
        - email
