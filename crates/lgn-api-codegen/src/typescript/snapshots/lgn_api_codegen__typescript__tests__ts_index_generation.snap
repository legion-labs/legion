---
source: crates/lgn-api-codegen/src/typescript/mod.rs
expression: content
---
// Auto-generated file

// @ts-ignore
import qs from "qs";

// ---------- Errors ----------

declare global {
  interface ErrorConstructor {
    captureStackTrace(thisArg: unknown, func: unknown): void;
  }
}

export class InternalError extends Error {
  constructor(message: string) {
    super(`Internal error: ${message}`);

    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, InternalError);
    }

    this.name = "InternalError";
  }
}

type Fetch = typeof globalThis.fetch;

const defaultFetch = globalThis.fetch;

export abstract class ApiClient {
  protected fetch: Fetch;
  protected onRequestStartInterceptors: ((
    ...request: Parameters<Fetch>
  ) => Promise<Parameters<Fetch>> | Parameters<Fetch>)[] = [];
  protected onRequestEndInterceptors: ((
    response: Response
  ) => Promise<Response> | Response)[] = [];

  constructor({ fetch = defaultFetch }: { fetch?: Fetch }) {
    this.fetch = fetch;
  }

  addRequestStartInterceptor(
    interceptor: (
      ...request: Parameters<Fetch>
    ) => Promise<Parameters<Fetch>> | Parameters<Fetch>
  ) {
    this.onRequestStartInterceptors.push(interceptor);
  }

  addRequestEndInterceptor(
    interceptor: (response: Response) => Promise<Response> | Response
  ) {
    this.onRequestEndInterceptors.push(interceptor);
  }

  protected async performRequest(
    ...args: Parameters<Fetch>
  ): Promise<Response> {
    let fetchArgs = args;

    for (const interceptor of this.onRequestStartInterceptors) {
      fetchArgs = await interceptor(...fetchArgs);
    }

    let response = await this.fetch(...fetchArgs);

    for (const interceptor of this.onRequestEndInterceptors) {
      response = await interceptor(response);
    }

    return response;
  }
}

// Models and API from: cars

export namespace Cars {
  export type TestOneOf200Response =
    | { type: "option1"; value: Components.Pet }
    | { type: "option2"; value: Components.Car };

  // ---------- Api ----------

  export interface Api {
    testHeaders(input: {
      headers: {
        "x-string-header"?: string;
        "x-bytes-header"?: Blob;
        "x-int-header"?: number;
      };
    }): Promise<TestHeadersResponse>;

    testOneOf(): Promise<TestOneOfResponse>;

    getCars(input: {
      params: {
        "space-id": string;
      };

      query: {
        names?: string[];
        q?: string;
      };
    }): Promise<GetCarsResponse>;

    createCar(input: {
      params: {
        "space-id": string;
      };

      headers: {
        "span-id"?: string;
      };

      body: Components.Car;
    }): Promise<CreateCarResponse>;

    getCar(input: {
      params: {
        "space-id": string;
        "car-id": bigint;
      };
    }): Promise<GetCarResponse>;

    deleteCar(input: {
      params: {
        "space-id": string;
        "car-id": bigint;
      };
    }): Promise<DeleteCarResponse>;

    testBinary(input: {
      params: {
        "space-id": string;
      };

      body: Blob;
    }): Promise<TestBinaryResponse>;
  }

  // ---------- Client ----------

  export class Client extends ApiClient implements Api {
    #baseUri: string | URL;

    constructor({
      baseUri,
      fetch = defaultFetch,
    }: {
      baseUri: string | URL;
      fetch?: Fetch;
    }) {
      super({ fetch });
      this.#baseUri = baseUri;
    }

    async testHeaders(input: {
      headers: {
        "x-string-header"?: string;
        "x-bytes-header"?: Blob;
        "x-int-header"?: number;
      };
    }): Promise<TestHeadersResponse> {
      const url = new URL(`${this.#baseUri}/test-headers`);

      const headers = new Headers();

      if ("x-string-header" in input.headers) {
        headers.set(
          "x-string-header",

          input.headers["x-string-header"]
        );
      }

      if ("x-bytes-header" in input.headers) {
        headers.set(
          "x-bytes-header",

          await input.headers["x-bytes-header"].text()
        );
      }

      if ("x-int-header" in input.headers) {
        headers.set(
          "x-int-header",

          input.headers["x-int-header"].toString()
        );
      }

      const response = await this.performRequest(url.toString(), {
        method: "GET",
        headers,
      });

      return TestHeadersResponse.fromResponse(response);
    }

    async testOneOf(): Promise<TestOneOfResponse> {
      const url = new URL(`${this.#baseUri}/test-one-of`);

      const headers = new Headers();

      const response = await this.performRequest(url.toString(), {
        method: "GET",
        headers,
      });

      return TestOneOfResponse.fromResponse(response);
    }

    async getCars(input: {
      params: {
        "space-id": string;
      };

      query: {
        names?: string[];
        q?: string;
      };
    }): Promise<GetCarsResponse> {
      const url = new URL(
        `${this.#baseUri}/v1/spaces/${
          input.params["space-id"]
        }/car-service/cars`
      );

      const query: GetCarsQuery = {
        names: input.query["names"],
        q: input.query["q"],
      };

      url.search = qs.stringify(query, { arrayFormat: "repeat" });

      const headers = new Headers();

      const response = await this.performRequest(url.toString(), {
        method: "GET",
        headers,
      });

      return GetCarsResponse.fromResponse(response);
    }

    async createCar(input: {
      params: {
        "space-id": string;
      };

      headers: {
        "span-id"?: string;
      };

      body: Components.Car;
    }): Promise<CreateCarResponse> {
      const url = new URL(
        `${this.#baseUri}/v1/spaces/${
          input.params["space-id"]
        }/car-service/cars`
      );

      const headers = new Headers();

      headers.set("Content-Type", "application/json");

      if ("span-id" in input.headers) {
        headers.set(
          "span-id",

          input.headers["span-id"]
        );
      }

      const response = await this.performRequest(url.toString(), {
        method: "POST",
        headers,

        body: JSON.stringify(input.body),
      });

      return CreateCarResponse.fromResponse(response);
    }

    async getCar(input: {
      params: {
        "space-id": string;
        "car-id": bigint;
      };
    }): Promise<GetCarResponse> {
      const url = new URL(
        `${this.#baseUri}/v1/spaces/${
          input.params["space-id"]
        }/car-service/cars/${input.params["car-id"]}`
      );

      const headers = new Headers();

      const response = await this.performRequest(url.toString(), {
        method: "GET",
        headers,
      });

      return GetCarResponse.fromResponse(response);
    }

    async deleteCar(input: {
      params: {
        "space-id": string;
        "car-id": bigint;
      };
    }): Promise<DeleteCarResponse> {
      const url = new URL(
        `${this.#baseUri}/v1/spaces/${
          input.params["space-id"]
        }/car-service/cars/${input.params["car-id"]}`
      );

      const headers = new Headers();

      const response = await this.performRequest(url.toString(), {
        method: "DELETE",
        headers,
      });

      return DeleteCarResponse.fromResponse(response);
    }

    async testBinary(input: {
      params: {
        "space-id": string;
      };

      body: Blob;
    }): Promise<TestBinaryResponse> {
      const url = new URL(
        `${this.#baseUri}/v1/spaces/${
          input.params["space-id"]
        }/car-service/test-binary`
      );

      const headers = new Headers();

      headers.set("Content-Type", "application/octet-stream");

      const response = await this.performRequest(url.toString(), {
        method: "POST",
        headers,

        body: input.body,
      });

      return TestBinaryResponse.fromResponse(response);
    }
  }

  // ---------- Parameters ----------

  export type GetCarsQuery = {
    names?: string[];
    q?: string;
  };

  // ---------- Responses ----------

  export type TestHeadersResponse = {
    /** Ok. */ type: "200";
    value: Components.Pet;
  };

  export const TestHeadersResponse = {
    async fromResponse(response: Response): Promise<TestHeadersResponse> {
      switch (response.status) {
        case 200: {
          return {
            type: "200",
            value: await response.json(),
          };
        }
        default: {
          throw new InternalError(`unexpected status code: ${response.status}`);
        }
      }
    },
  };

  export type TestOneOfResponse = {
    /** Ok. */ type: "200";
    value: TestOneOf200Response;
  };

  export const TestOneOfResponse = {
    async fromResponse(response: Response): Promise<TestOneOfResponse> {
      switch (response.status) {
        case 200: {
          return {
            type: "200",
            value: await response.json(),
          };
        }
        default: {
          throw new InternalError(`unexpected status code: ${response.status}`);
        }
      }
    },
  };

  export type GetCarsResponse = {
    /** List of cars. */ type: "200";
    value: Components.Cars;
  };

  export const GetCarsResponse = {
    async fromResponse(response: Response): Promise<GetCarsResponse> {
      switch (response.status) {
        case 200: {
          return {
            type: "200",
            value: await response.json(),
          };
        }
        default: {
          throw new InternalError(`unexpected status code: ${response.status}`);
        }
      }
    },
  };

  export type CreateCarResponse = { /** Created. */ type: "201" };

  export const CreateCarResponse = {
    async fromResponse(response: Response): Promise<CreateCarResponse> {
      switch (response.status) {
        case 201: {
          return {
            type: "201",
          };
        }
        default: {
          throw new InternalError(`unexpected status code: ${response.status}`);
        }
      }
    },
  };

  export type GetCarResponse =
    | { /** A car. */ type: "200"; value: Components.Car }
    | { /** Car not found. */ type: "404" };

  export const GetCarResponse = {
    async fromResponse(response: Response): Promise<GetCarResponse> {
      switch (response.status) {
        case 200: {
          return {
            type: "200",
            value: await response.json(),
          };
        }
        case 404: {
          return {
            type: "404",
          };
        }
        default: {
          throw new InternalError(`unexpected status code: ${response.status}`);
        }
      }
    },
  };

  export type DeleteCarResponse =
    | { /** Car deleted. */ type: "200" }
    | { /** Car not found. */ type: "404" };

  export const DeleteCarResponse = {
    async fromResponse(response: Response): Promise<DeleteCarResponse> {
      switch (response.status) {
        case 200: {
          return {
            type: "200",
          };
        }
        case 404: {
          return {
            type: "404",
          };
        }
        default: {
          throw new InternalError(`unexpected status code: ${response.status}`);
        }
      }
    },
  };

  export type TestBinaryResponse = { /** Ok. */ type: "200"; value: Blob };

  export const TestBinaryResponse = {
    async fromResponse(response: Response): Promise<TestBinaryResponse> {
      switch (response.status) {
        case 200: {
          return {
            type: "200",
            value: await response.blob(),
          };
        }
        default: {
          throw new InternalError(`unexpected status code: ${response.status}`);
        }
      }
    },
  };
}

// Models and API from: components

export namespace Components {
  export type Car = {
    color: CarColor;
    extra?: Blob;
    id: bigint;
    is_new: boolean;
    name: string;
  };

  /** The car color. */
  export type CarColor = "red" | "blue" | "yellow";

  export type Cars = Car[];

  export type Pet = {
    name?: string;
  };
}

